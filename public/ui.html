<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <title>Sää App</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:ital,opsz,wght@0,17..18,400..700;1,17..18,400..700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="google-sans-basic">
  <video autoplay muted loop id="bgVideo">
    <source src="14315434_3840_2160_30fps.mp4" type="video/mp4">
    Your browser does not support the video tag.
    https://www.pexels.com/video/fluffy-clouds-against-blue-sky-timelapse-33704425/
  </video>

  <div id="settings">
    <label for="place">Paikkakunta:</label>
    <input id="place" value="Pori" />
    <button onclick="getWeather()">Päivitä</button>
  </div>

  <button id="settingsBtn">⚙️</button>
  
  <section id="result"></section>

  <script>
  const settingsBtn = document.getElementById("settingsBtn");
  const settings = document.getElementById("settings");

  settingsBtn.addEventListener("click", () => {
    settings.classList.toggle("open");
  });

  function formatTime(isoString) {
    const date = new Date(isoString);

    const datePart = date.toLocaleDateString("fi-FI", {
      day: "numeric",
      month: "long",
      year: "numeric"
    });

    const timePart = date.toLocaleTimeString("fi-FI", {
      hour: "2-digit",
      minute: "2-digit"
    });

    return { datePart, timePart };
  }
  async function getWeather() {
    const place = document.getElementById("place").value;
    const response = await fetch(`/api/weather?place=${encodeURIComponent(place)}`);
    const data = await response.json();

    const { datePart, timePart } = formatTime(data.time);

    document.getElementById("result").innerHTML = `
      <div class="temperature">
        ${data.temperature ?? "-"} °C
      </div>
    `;
    document.getElementById("settings").innerHTML += `
      <div style="opacity:0.7; font-size:0.9em">
        ${datePart}<br/>
        ${timePart}
      </div>
    `;
  }
  setInterval(getWeather, 600000); // Päivitä sää minuutin välein
  getWeather(); // Hae sää heti sivun latautuessa

  // Käynnistä ping-pong
  const video = document.getElementById("bgVideo");
  // Hitaampi toisto
  video.playbackRate = 0.5; // 0.5 = puoli nopeus

  </script>
</body>
</html>